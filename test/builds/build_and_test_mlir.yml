trigger: none

jobs:

- job: 'Ubuntu'
  workspace:
    clean: all
  pool:
    vmImage: 'ubuntu-16.04'

  steps:

  - task: Cache@2
    inputs:
      key: 'llvm_mlir | "$(Agent.OS)" | e03394c6a6f'
      path: llvm-project
      cacheHitVar: CACHE_RESTORED

  - script: sh ./test/builds/install_linux_mlir.sh || (sleep 30 && sh ./test/builds/install_linux_mlir.sh) || (sleep 30 && sh ./test/builds/install_linux_mlir.sh)
    displayName: 'Install dependencies'

  - script: sh ./test/builds/build_and_test_mlir.sh
    displayName: Building LLVM/MLIR
    condition: ne(variables.CACHE_RESTORED, 'true')

  # - script: sh ./test/builds/build_and_test_kscmlir.sh
  #   displayName: Testing Ksc MLIR
